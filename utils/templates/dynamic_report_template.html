<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{{ title | default("Report Readout") }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg: #f7f9fc;
      --card: #ffffff;
      --muted: #6c757d;
      --text: #212529;
      --ok: #28a745;
      --warn: #f0ad4e;
      --bad: #dc3545;
      --chip-bg: #f1f3f9;
      --border: #e0e6ef;
      --radius: 12px;
      --gap: 20px;
      --max-width: 1100px;
      --shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font: 15px/1.6 system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      padding: 24px;
    }
    .container{max-width:var(--max-width);margin:0 auto}
    .title{
      font-size: 28px;
      font-weight: 800;
      margin: 6px 0 8px;
      color:var(--text);
    }
    .subtitle{color:var(--muted);margin:0 0 24px;font-weight:600}
    .kpis{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--gap);
      margin-bottom:32px;
    }
    @media (max-width: 900px){ .kpis{grid-template-columns: repeat(2, 1fr)} }
    @media (max-width: 480px){ .kpis{grid-template-columns: 1fr} }
    .card{
      background:var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding:18px;
      box-shadow: var(--shadow);
    }
    .kpi-label{color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.12em}
    .kpi-value{font-size:26px;font-weight:700;margin-top:8px;color:var(--text)}
    .kpi-sub{color:var(--muted);font-size:13px;margin-top:4px}
    .topics{display:grid;grid-template-columns: repeat(12, 1fr);gap:var(--gap)}
    .topic{grid-column: span 6; margin-bottom:20px; page-break-inside: avoid;}
    @media (max-width: 900px){ .topic{grid-column: span 12} }
    .topic h3{margin:0 0 8px;font-size:18px;color:var(--text)}
    .meta{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0 14px}
    .chip{
      padding:5px 10px;
      border-radius:999px;
      background:var(--chip-bg);
      border:1px solid var(--border);
      font-size:13px;
      color:var(--text);
      font-weight:600;
    }
    
    .chip.ok, .score.ok {
      color: var(--ok);
      border-color: rgba(40, 167, 69, .3);
    }

    .chip.warn, .score.warn {
      color: var(--warn);
      border-color: rgba(240, 173, 78, .3);
    }

    .chip.bad, .score.bad {
      color: var(--bad);
      border-color: rgba(220, 53, 69, .3);
    }
    
    .grid-two{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    /* Add this new CSS rule for a 3-column grid */
    .grid-3{display:grid;grid-template-columns:repeat(3, 1fr);gap:var(--gap)}
    @media (max-width:900px){ .grid-3{grid-template-columns:repeat(2, 1fr)} }
    @media (max-width:480px){ .grid-3{grid-template-columns:1fr} }
    .block{
      background:#fafbfe;
      border:1px dashed var(--border);
      border-radius:8px;
      padding:12px;
      font-size:14px;
    }
    .block strong{display:block;margin-bottom:4px;color:var(--muted)}
    .block.summary-block{margin-top:12px}
    table{width:100%;border-collapse:collapse;margin-top:20px;font-size:14px;border:1px solid var(--border)}
    th,td{padding:10px 12px;border:1px solid var(--border);vertical-align:top}
    th{background:#f1f3f9;font-weight:600;text-align:left;color:var(--text)}
    tbody tr:nth-child(even){background:#fafbfe}
    .footer-note{color:var(--muted);font-size:13px;margin-top:10px}
    @media print {
      body { background:#fff; color:#000; font-size:12pt; padding:0; }
      .card { border:1px solid #ccc; box-shadow:none; background:#fff; }
      .topics .topic, table { page-break-inside: avoid; }
      .chip { background:#f8f9fa; color:#000; }
    }
  </style>
</head>
<body>
  <div class="container">
    <p class="subtitle">{{ subtitle | default("Report") }}</p>
    <h1 class="title">{{ title | default("Evaluation Report Readout") }}</h1>

    {# ---------------- Call Evaluation + Extra Topics ---------------- #}
    {% if kpis.Pre_Call_Planning_Subtotal is defined %}
      <h2 style="margin-top:40px; margin-bottom: 20px;">Sales Call Evaluation Report</h2>
      <h3 style="margin-top:40px; margin-bottom: 20px;">KPI's</h3>

    {# ---------------- KPI Cards ---------------- #}
    <section class="kpis">
        <div class="card">
            <div class="kpi-label">Pre-Call Planning Score</div>
            <div class="kpi-value">{{ kpis.Pre_Call_Planning_Subtotal }}</div>
            <div class="kpi-sub">
                Max: {{ kpis.Pre_Call_Planning_Max_Possible_Score }}, 
                {{ "%.2f"|format(kpis.Pre_Call_Planning_Percentage) }}%
            </div>
        </div>
        <div class="card">
            <div class="kpi-label">While in the Shop Score</div>
            <div class="kpi-value">{{ kpis.While_in_the_Shop_Subtotal}}</div>
            <div class="kpi-sub">
                Max: {{ kpis.While_in_the_Shop_Max_Possible_Score }}, 
                {{ "%.2f"|format(kpis.While_in_the_Shop_Percentage) }}%
            </div>
        </div>
        <div class="card">
            <div class="kpi-label">Extra Topics Impact Score</div>
            <div class="kpi-value">{{ kpis.Extra_Topics_Subtotal }}</div>
            <div class="kpi-sub">
                Max: {{ kpis.Extra_Topics_Max_Possible_Score }}, 
                {{ "%.2f"|format(kpis.Extra_Topics_Percentage) }}%
            </div>
        </div>
    </section>

      {# ---------------- Pre-Call Planning ---------------- #}
        <h2 style="margin-top:24px; margin-bottom: 12px;">Pre-Call Planning Report</h2>
        <section class="topics">
          {% for topic in data["Pre_Call_Planning"] %}
            <div class="topic">
              <h3>{{ topic.id | e }}) {{ topic.Topic | e }}</h3>
              <div class="meta">
                <span class="chip score
                  {% if topic.Topic_Score == 2 %}ok
                  {% elif topic.Topic_Score == 1 %}warn
                  {% else %}bad{% endif %}">
                  Score: {{ topic.Topic_Score }}
                </span>
                <span class="chip">{{ topic.Topic_Quality }}</span>
              </div>
              <div class="block"><strong>Content:</strong> {{ topic.Topic_Content }}</div>
              <div class="block"><strong>Evidence:</strong> {{ topic.Topic_Evidence }}</div>
              <div class="block"><strong>Reason:</strong> {{ topic.Reason_for_Topic_Quality }}</div>
              <div class="block summary-block"><strong>Summary:</strong> {{ topic.Summary }}</div>
            </div>
          {% endfor %}
        </section>

      {# ---------------- While in the Shop ---------------- #}
        <h2 style="margin-top:24px; margin-bottom: 12px;">While in the Shop Report</h2>
        <section class="topics">
          {% for topic in data["While_in_the_Shop"] %}
            <div class="topic">
              <h3>{{ topic.id | e }}) {{ topic.Topic | e }}</h3>
              <div class="meta">
                <span class="chip score
                  {% if topic.Topic_Score == 2 %}ok
                  {% elif topic.Topic_Score == 1 %}warn
                  {% else %}bad{% endif %}">
                  Score: {{ topic.Topic_Score }}
                </span>
                <span class="chip">{{ topic.Topic_Quality }}</span>
              </div>
              <div class="block"><strong>Content:</strong> {{ topic.Topic_Content }}</div>
              <div class="block"><strong>Evidence:</strong> {{ topic.Topic_Evidence }}</div>
              <div class="block"><strong>Reason:</strong> {{ topic.Reason_for_Topic_Quality }}</div>
              <div class="block summary-block"><strong>Summary:</strong> {{ topic.Summary }}</div>
            </div>
          {% endfor %}
        </section>

      {# ---------------- Extra Topics ---------------- #}
        <h3 style="margin-top:24px; margin-bottom: 12px;">Extra Topics</h3>
        <section class="topics">
          {% for topic in data["Extra_Topics"] %}
            <div class="topic">
              <h3>{{ topic.id | e }}) {{ topic.Topic | e }}</h3>
              <div class="meta">
                <span class="chip score
                  {% if topic.Topic_Score > 0 %}ok
                  {% elif topic.Topic_Score == 0 %}warn
                  {% else %}bad{% endif %}">
                  Score: {{ topic.Topic_Score }}
                </span>
                <span class="chip">{{ topic.Topic_Quality }}</span>
              </div>
              <div class="block"><strong>Content:</strong> {{ topic.Topic_Content }}</div>
              <div class="block"><strong>Evidence:</strong> {{ topic.Topic_Evidence }}</div>
              <div class="block"><strong>Reason:</strong> {{ topic.Reason_for_Topic_Quality }}</div>
              <div class="block summary-block"><strong>Summary:</strong> {{ topic.Summary }}</div>
            </div>
          {% endfor %}
        </section>
    {% endif %}


    {# ---------------- Candidate's Self Understanding ---------------- #}
    {% if kpis.Candidate_Subtotal_Score is defined %}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Candidate's Evaluation Report</h2>
    <h3 style="margin-top:40px; margin-bottom: 20px;">KPI's</h3>
    
    {# ---------------- KPI Cards ---------------- #}
    <section class="kpis">
        <div class="card">
            <div class="kpi-label">Subtotal Score</div>
            <div class="kpi-value">{{ kpis.Candidate_Subtotal_Score }}</div>
            <div class="kpi-sub">
                Max: {{ kpis.Max_Possible_Score }}, 
                {{ "%.2f"|format(kpis.Candidate_Understanding_Percentage) }}%
            </div>
        </div>
        <div class="card">
            <div class="kpi-label">Extra Topics Impact Score</div>
            <div class="kpi-value">{{ kpis.Extra_Topics_Impact_Score }}</div>
            <div class="kpi-sub">
                Max: {{ kpis.Extra_Topics_Max_Possible_Score }}, 
                {{ "%.2f"|format(kpis.Extra_Topics_Percentage) }}%
            </div>
        </div>
    </section>

    {# ---------------- Topic Details for Candidate's Self Understanding ---------------- #}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Candidate's Evaluation Topics</h2>

    <section class="topics">
        {% for topic in data["Candidate_Self_Understanding"] %}
        <div class="topic">
            <h3>{{ topic.id | e }}) {{ topic.Topic | e }}</h3>
            <div class="meta">
                <span class="chip score
                    {% if topic.Topic_Score == 2 %}ok
                    {% elif topic.Topic_Score == 1 %}warn
                    {% else %}bad{% endif %}">
                    Topic Score: {{ topic.Topic_Score }}
                </span>
                <span class="chip">{{ topic.Topic_Quality }}</span>
            </div>
            <div class="block"><strong>Content:</strong> {{ topic.Topic_Content }}</div>
            <div class="block"><strong>Evidence:</strong> {{ topic.Topic_Evidence }}</div>
            <div class="block"><strong>Reason:</strong> {{ topic.Reason_for_Topic_Quality }}</div>
            <div class="block summary-block"><strong>Summary:</strong> {{ topic.Summary }}</div>
        </div>
        {% endfor %}
    </section>

    {# ---------------- Extra Topics ---------------- #}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Extra Topics</h2>

    <section class="topics">
        {% for topic in data["Extra_Topics"] %}
        <div class="topic">
            <h3>{{ topic.id | e }}) {{ topic.Topic | e }}</h3>
            <div class="meta">
                <span class="chip score
                    {% if topic.Topic_Score > 0 %}ok
                    {% elif topic.Topic_Score == 0 %}warn
                    {% else %}bad{% endif %}">
                    Score: {{ topic.Topic_Score }}
                </span>
                <span class="chip">{{ topic.Topic_Quality }}</span>
            </div>
            <div class="block"><strong>Content:</strong> {{ topic.Topic_Content }}</div>
            <div class="block"><strong>Evidence:</strong> {{ topic.Topic_Evidence }}</div>
            <div class="block"><strong>Reason:</strong> {{ topic.Reason_for_Topic_Quality }}</div>
            <div class="block summary-block"><strong>Summary:</strong> {{ topic.Summary }}</div>
        </div>
        {% endfor %}
    </section>
    {% endif %}


    {# ---------------- Manager_Compliance_Assessment ---------------- #}
    {% if kpis.Manager_Subtotal_Score is defined %}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Manager Compliance Assessment Report</h2>
    <h3 style="margin-top:40px; margin-bottom: 20px;">KPI's</h3>
    
    {# ---------------- KPI Cards ---------------- #}
    <section class="kpis">
        <div class="card">
            <div class="kpi-label">Subtotal Score</div>
            <div class="kpi-value">{{ kpis.Manager_Subtotal_Score }}</div>
            <div class="kpi-sub">
                Max: {{ kpis.Max_Possible_Score }}, 
                {{ "%.2f"|format(kpis.Manager_Compliance_Percentage) }}%
            </div>
        </div>
        <div class="card">
            <div class="kpi-label">Extra Topics Impact Score</div>
            <div class="kpi-value">{{ kpis.Extra_Topics_Impact_Score }}</div>
            <div class="kpi-sub">
                Max: {{ kpis.Extra_Topics_Max_Possible_Score }}, 
                {{ "%.2f"|format(kpis.Extra_Topics_Percentage) }}%
            </div>
        </div>
    </section>

    {# ---------------- Topic Details for Manager Compliance Assessment ---------------- #}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Manager's Evaluation Topics</h2>
    <section class="topics">
        {% for topic in data["Manager_Compliance_Assessment"] %}
        <div class="topic">
            <h3>{{ topic.id | e }}) {{ topic.Topic | e }}</h3>
            <div class="meta">
                <span class="chip score
                    {% if topic.Topic_Score > 0 %}ok
                    {% elif topic.Topic_Score == 0 %}bad
                    {% else %}warn{% endif %}">
                    Topic Score: {{ topic.Topic_Score }}
                </span>
                <span class="chip">{{ topic.Topic_Quality }}</span>
            </div>
            <div class="block"><strong>Content:</strong> {{ topic.Topic_Content }}</div>
            <div class="block"><strong>Evidence:</strong> {{ topic.Topic_Evidence }}</div>
            <div class="block"><strong>Reason:</strong> {{ topic.Reason_for_Topic_Quality }}</div>
            <div class="block summary-block"><strong>Summary:</strong> {{ topic.Summary }}</div>
        </div>
        {% endfor %}
    </section>

    {# ---------------- Extra Topics ---------------- #}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Extra Topics</h2>

    <section class="topics">
        {% for topic in data["Extra_Topics"] %}
        <div class="topic">
            <h3>{{ topic.id | e }}) {{ topic.Topic | e }}</h3>
            <div class="meta">
                <span class="chip score
                    {% if topic.Topic_Score > 0 %}ok
                    {% elif topic.Topic_Score == 0 %}warn
                    {% else %}bad{% endif %}">
                    Score: {{ topic.Topic_Score }}
                </span>
                <span class="chip">{{ topic.Topic_Quality }}</span>
            </div>
            <div class="block"><strong>Content:</strong> {{ topic.Topic_Content }}</div>
            <div class="block"><strong>Evidence:</strong> {{ topic.Topic_Evidence }}</div>
            <div class="block"><strong>Reason:</strong> {{ topic.Reason_for_Topic_Quality }}</div>
            <div class="block summary-block"><strong>Summary:</strong> {{ topic.Summary }}</div>
        </div>
        {% endfor %}
    </section>
    {% endif %}

    {# ---------------- Interactive Training Session ---------------- #}
    {% if kpis.Recruiter_Total_Earned is defined %}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Interactive Training Session</h2>

    {# ---------------- KPI Cards ---------------- #}
    <h3 style="margin-top:40px; margin-bottom: 20px;">KPI's</h3>
    <section class="kpis">
        <div class="card">
            <div class="kpi-label">Recruiter Score Earned</div>
            <div class="kpi-value">{{ kpis.Recruiter_Total_Earned }}</div>
            <div class="kpi-sub">Max: {{ kpis.Recruiter_Max_Score }}, {{ "%.2f"|format(kpis.Recruiter_Percentage) }}%</div>
        </div>
        <div class="card">
            <div class="kpi-label">Candidate Score Earned</div>
            <div class="kpi-value">{{ kpis.Candidate_Total_Earned }}</div>
            <div class="kpi-sub">Max: {{ kpis.Candidate_Max_Score }}, {{ "%.2f"|format(kpis.Candidate_Percentage) }}%</div>
        </div>
        <div class="card">
            <div class="kpi-label">Total Extra Questions</div>
            <div class="kpi-value">{{ kpis.Extra_Questions_Totals.Total_extra_questions }}</div>
        </div>
        <div class="card">
            <div class="kpi-label">Helpful Extra Questions</div>
            <div class="kpi-value">{{ kpis.Extra_Questions_Totals.Helpful_extra_questions }}</div>
            <div class="kpi-sub">Percentage: {{ kpis.Extra_Percentages.Helpful_extra_percentage }}%</div>
        </div>
        <div class="card">
            <div class="kpi-label">Neutral Extra Questions</div>
            <div class="kpi-value">{{ kpis.Extra_Questions_Totals.Neutral_extra_questions }}</div>
            <div class="kpi-sub">Percentage: {{ kpis.Extra_Percentages.Neutral_extra_percentage }}%</div>
        </div>
        <div class="card">
            <div class="kpi-label">Unhelpful Extra Questions</div>
            <div class="kpi-value">{{ kpis.Extra_Questions_Totals.Unhelpful_extra_questions }}</div>
            <div class="kpi-sub">Percentage: {{ kpis.Extra_Percentages.Unhelpful_extra_percentage }}%</div>
        </div>
        <div class="card">
            <div class="kpi-label">Candidate Answered Extra Questions</div>
            <div class="kpi-value">{{ kpis.Extra_Questions_Totals.Candidate_answered_extra_questions }}</div>
            <div class="kpi-sub">Candidate Extra %: {{ kpis.Extra_Percentages.Candidate_extra_percentage }}%</div>
        </div>
    </section>

    {# ---------------- Training Topics Cards ---------------- #}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Recruiter Training Evaluation Topics</h2>
    <section class="topics">
        {% for topic in data["Interactive Training Session Conducted by Recruiter"] %}
        <div class="topic">
            <h3>{{ topic.id | e }}) {{ topic.Topic | e }}</h3>
            <div class="meta">
                <span class="chip score
                    {% if topic.Recruiter_Score == 2 %}ok
                    {% elif topic.Recruiter_Score == 1 %}warn
                    {% else %}bad{% endif %}">
                    Recruiter Score: {{ topic.Recruiter_Score }}
                </span>
                <span class="chip score
                    {% if topic.Candidate_Score == 2 %}ok
                    {% elif topic.Candidate_Score== 1 %}warn
                    {% else %}bad{% endif %}">
                    Candidate Score: {{ topic.Candidate_Score }}
                </span>
                <span class="chip">Candidate Quality: {{ topic.candidate_response_quality }}</span>
            </div>
            <div class="block"><strong>Content:</strong> {{ topic.Topic_Content }}</div>
            <div class="block"><strong>Evidence:</strong> {{ topic.Topic_Evidence }}</div>
            <div class="block"><strong>Topic Quality:</strong> {{ topic.Topic_Quality }}</div>
        </div>
        {% endfor %}
    </section>

    {# ---------------- Interactive Extra Topics Cards ---------------- #}
    {# Topic Details for Interactive Extra Topics #}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Extra Topics</h2>
    <section class="topics">
        {% for topic in data["Extra_Topics"] %}
        <div class="topic">
            <h3>{{ topic.id | e }}) {{ topic.Topic | e }}</h3>
            <div class="meta">
                <span class="chip score
                    {% if topic.Recruiter_Score > 0 %}ok
                    {% elif topic.Recruiter_Score == 0 %}warn
                    {% else %}bad{% endif %}">
                    Recruiter Score: {{ topic.Recruiter_Score }}
                </span>
            </div>
            <div class="block"><strong>Content:</strong> {{ topic.Topic_Content }}</div>
            <div class="block"><strong>Evidence:</strong> {{ topic.Topic_Evidence }}</div>
        </div>
        {% endfor %}
    </section>
    {% endif %}


    {# ---------------- Interview Questions & Responses ---------------- #}
    {%- if data["Interview_Questionair_Responses"] %}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Interview Evaluation Report</h2>

    {# ---------------- KPIs for Interview Section ---------------- #}
    {% if kpis["Interview_Questions_Predefined"] or kpis["Interview_Questions_Extra"] %}
    <h3 style="margin-top:40px; margin-bottom: 20px;">KPI's</h3>
    <section class="kpis">
      {% if kpis["Interview_Questions_Predefined"] %}
      {% for key, value in kpis["Interview_Questions_Predefined"].items() %}
      <div class="card">
        <div class="kpi-label">{{ key.replace('_',' ') }}</div>
        <div class="kpi-value">{{ value }}</div>
      </div>
      {% endfor %}
      {% endif %}

      {% if kpis["Interview_Questions_Extra"] %}
      {% for key, value in kpis["Interview_Questions_Extra"].items() %}
        {% if key != "Recruiter_extra_percentages" %}
        <div class="card">
          <div class="kpi-label">{{ key.replace('_',' ') }}</div>
          <div class="kpi-value">{{ value }}</div>
        </div>
        {% endif %}
      {% endfor %}
      {% endif %}
    </section>
    {% endif %}

    {# ---------------- Recruiter Extra Percentages ---------------- #}
    {% if kpis["Interview_Questions_Extra"]["Recruiter_extra_percentages"] %}
    <section class="kpis">
      {% set rec_extra = kpis["Interview_Questions_Extra"]["Recruiter_extra_percentages"] %}
      <div class="card">
        <div class="kpi-label">Helpful Extra %</div>
        <div class="kpi-value">{{ rec_extra.Helpful_extra_percentage }}</div>
      </div>
      <div class="card">
        <div class="kpi-label">Neutral Extra %</div>
        <div class="kpi-value">{{ rec_extra.Neutral_extra_percentage }}</div>
      </div>
      <div class="card">
        <div class="kpi-label">Unhelpful Extra %</div>
        <div class="kpi-value">{{ rec_extra.Unhelpful_extra_percentage }}</div>
      </div>
      <div class="card">
        <div class="kpi-label">Overall Recruiter Extra %</div>
        <div class="kpi-value">{{ rec_extra.Overall_recruiter_extra_percentage }}</div>
      </div>
    </section>
    {% endif %}


    {# ---------------- Question-Response Cards ---------------- #}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Interview Evaluation Topics</h2>
    <section class="topics">
      {%- for row in data["Interview_Questionair_Responses"] %}
      <article class="card topic">
        <h3>{{ row.id | e }}) {{ row.Competency | e }}</h3>
        <div class="meta">
          <span class="chip">Question: {{ row.Predefined_Question | e }}</span>
          <span class="chip">Asked: {{ row.Question_asked | e }}</span>
          {%- set q_score_class = 'ok' if row.Question_score == 1 else 'warn' if row.Question_score == 0.5 else 'bad' %}
          <span class="chip score {{ q_score_class }}">Q Score: {{ row.Question_score | e }}</span>
          {%- set r_score_class = 'ok' if row.Response_score == 1 else 'warn' if row.Response_score == 0.5 else 'bad' %}
          <span class="chip score {{ r_score_class }}">R Score: {{ row.Response_score | e }}</span>
        </div>
        <div class="block">
          <strong>Response</strong>
          <div>{{ row.Response | e }}</div>
        </div>
        <div class="block">
          <strong>Reason for QQ</strong>
          <div>{{ row.Reason_for_QQ | e }}</div>
        </div>
        <div class="block">
          <strong>Reason for RQ</strong>
          <div>{{ row.Reason_for_RQ | e }}</div>
        </div>
        <div class="block summary-block">
          <strong>Summary</strong>
          <div>{{ row.Summary | e }}</div>
        </div>
      </article>
      {%- endfor %}
    </section>

    {# ---------------- Extra Question Cards ---------------- #}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Extra Questions Asked by Recruiter</h2>
    <section class="topics">
      {%- for row in data["extra_questions"] %}
      <article class="card topic">
        <h3>{{ row.id | e }}) {{ row.Competency | e }}</h3>
        <div class="meta">
          <span class="chip">Question: {{ row.Question | e }}</span>
          
          {# Assign color class based on Quality #}
          {%- set quality_class = 
            'ok' if row.Quality == 'Helpful' else 
            'warn' if row.Quality == 'Neutral' else 
            'bad' 
          %}
          <span class="chip {{ quality_class }}">Quality: {{ row.Quality | e }}</span>

          {# Score coloring logic #}
          {%- set q_score_class = 
            'ok' if row.Question_quality_score == 0.5 else 
            'warn' if row.Question_quality_score == 0 else 
            'bad' 
          %}
          <span class="chip score {{ q_score_class }}">Q Score: {{ row.Question_quality_score | e }}</span>
        </div>

        <div class="block summary-block">
          <strong>Summary</strong>
          <div>{{ row.Summary | e }}</div>
        </div>
      </article>
      {%- endfor %}
    </section>


    {# ---------------- Interviewer & Candidate Feedback ---------------- #}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Interviewer & Candidate Feedback Report</h2>
    <div class="grid-two" style="margin-top:20px">
      {%- if data["interviewer_feedback"] %}
      <div class="card block">
        <strong style="color: black; font-weight: bold;"> Interviewer Feedback</strong>
        <p><strong>Strengths:</strong> {{ data["interviewer_feedback"]["strengths"] | e }}</p>
        <p><strong>Weaknesses:</strong> {{ data["interviewer_feedback"]["weaknesses"] | e }}</p>
        <p><strong>Recommendations:</strong> {{ data["interviewer_feedback"]["recommendations"] | e }}</p>
        <p><strong>Average Score:</strong> {{ data["interviewer_feedback"]["average_score"] | e }}</p>
      </div>
      {%- endif %}
      {%- if data["candidate_feedback"] %}
      <div class="card block">
        <strong style="color: black; font-weight: bold;"> Candidate Feedback</strong>
        <p><strong>Average Score:</strong> {{ data["candidate_feedback"]["average_score"] | e }}</p>
        <p><strong>Response Summary:</strong> {{ data["candidate_feedback"]["response_quality_summary"] | e }}</p>
        <p><strong>Recommendations:</strong> {{ data["candidate_feedback"]["recommendations"] | e }}</p>
        {%- if data["candidate_feedback"]["personality_assessment"] %}
        <h4>Personality Assessment</h4>
        {%- for key, traits in data["candidate_feedback"]["personality_assessment"].items() %}
        <p><strong>{{ key | replace('_', ' ') }}:</strong></p>
        <ul>
          {%- for trait, detail in traits.items() %}
          <li>{{ trait }}: {{ "✅" if detail.value else "❌" }} ({{ detail.reason }})</li>
          {%- endfor %}
        </ul>
        {%- endfor %}
        {%- endif %}
      </div>
      {%- endif %}
    </div>
    {%- endif %}  
  </div>
</body>
</html>