<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{{ title | default("Report Readout") }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg: #f7f9fc;
      --card: #ffffff;
      --muted: #6c757d;
      --text: #212529;
      --ok: #28a745;
      --warn: #f0ad4e;
      --bad: #dc3545;
      --chip-bg: #f1f3f9;
      --border: #e0e6ef;
      --radius: 12px;
      --gap: 20px;
      --max-width: 1100px;
      --shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font: 15px/1.6 system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      padding: 24px;
    }
    .container{max-width:var(--max-width);margin:0 auto}
    .title{
      font-size: 28px;
      font-weight: 800;
      margin: 6px 0 8px;
      color:var(--text);
    }
    .subtitle{color:var(--muted);margin:0 0 24px;font-weight:600}
    .kpis{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--gap);
      margin-bottom:32px;
    }
    @media (max-width: 900px){ .kpis{grid-template-columns: repeat(2, 1fr)} }
    @media (max-width: 480px){ .kpis{grid-template-columns: 1fr} }
    .card{
      background:var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding:18px;
      box-shadow: var(--shadow);
    }
    .kpi-label{color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.12em}
    .kpi-value{font-size:26px;font-weight:700;margin-top:8px;color:var(--text)}
    .kpi-sub{color:var(--muted);font-size:13px;margin-top:4px}
    .topics{display:grid;grid-template-columns: repeat(12, 1fr);gap:var(--gap)}
    .topic{grid-column: span 6; margin-bottom:20px; page-break-inside: avoid;}
    @media (max-width: 900px){ .topic{grid-column: span 12} }
    .topic h3{margin:0 0 8px;font-size:18px;color:var(--text)}
    .meta{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0 14px}
    .chip{
      padding:5px 10px;
      border-radius:999px;
      background:var(--chip-bg);
      border:1px solid var(--border);
      font-size:13px;
      color:var(--text);
      font-weight:600;
    }
    .score.ok{color:var(--ok);border-color:rgba(40,167,69,.3)}
    .score.warn{color:var(--warn);border-color:rgba(240,173,78,.3)}
    .score.bad{color:var(--bad);border-color:rgba(220,53,69,.3)}
    .grid-two{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:720px){ .grid-two{grid-template-columns:1fr} }
    .block{
      background:#fafbfe;
      border:1px dashed var(--border);
      border-radius:8px;
      padding:12px;
      font-size:14px;
    }
    .block strong{display:block;margin-bottom:4px;color:var(--muted)}
    .block.summary-block{margin-top:12px}
    table{width:100%;border-collapse:collapse;margin-top:20px;font-size:14px;border:1px solid var(--border)}
    th,td{padding:10px 12px;border:1px solid var(--border);vertical-align:top}
    th{background:#f1f3f9;font-weight:600;text-align:left;color:var(--text)}
    tbody tr:nth-child(even){background:#fafbfe}
    .footer-note{color:var(--muted);font-size:13px;margin-top:10px}
    @media print {
      body {
        background:#fff;
        color:#000;
        font-size:12pt;
        padding:0;
      }
      .card {
        border:1px solid #ccc;
        box-shadow:none;
        background:#fff;
      }
      .topics .topic, table {
        page-break-inside: avoid;
      }
      .chip {
        background:#f8f9fa;
        color:#000;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <p class="subtitle">{{ subtitle | default("Report") }}</p>
    <h1 class="title">{{ title | default("Report Readout") }}</h1>

    {%- if kpis %}
    <section class="kpis">
      {%- for key, value in kpis.items() %}
      <div class="card"><div class="kpi-label">{{ key.replace('_', ' ') }}</div><div class="kpi-value">{{ value }}</div><div class="kpi-sub"></div></div>
      {%- endfor %}
    </section>
    {%- endif %}

    {%- set report_sections = {
        "Candidate_Self_Understanding": "Candidate Self-Understanding",
        "Manager_Compliance_Assessment": "Manager Compliance Assessment",
        "Pre_Call_Planning": "Pre-Call Planning",
        "While_in_the_Shop": "While in the Shop"
    } %}
    {%- for key, title in report_sections.items() %}
    {%- if data[key] %}
    <h2 style="margin-top:40px; margin-bottom: 20px;">{{ title }}</h2>
    <section class="topics">
      {%- for row in data[key] %}
      <article class="card topic">
        <h3>{{ row.id | e }}) {{ row.Topic | e }}</h3>
        <div class="meta">
          {%- if row.Topic_Score is defined %}
          {%- set score_class = 'ok' if row.Topic_Score >= 1 else 'warn' if row.Topic_Score > 0 else 'bad' %}
          {%- set score_emoji = '✅' if row.Topic_Score >= 1 else '⚠️' if row.Topic_Score > 0 else '❌' %}
          <span class="chip score {{ score_class }}">Score: {{ score_emoji }} {{ row.Topic_Score }}</span>
          {%- endif %}
          <span class="chip">{{ row.Topic_Quality | e }}</span>
        </div>
        <div class="grid-two">
          <div class="block">
            <strong>Topic Content</strong>
            <div>{{ row.Topic_Content | e }}</div>
          </div>
          <div class="block">
            <strong>Reason for Quality</strong>
            <div>{{ row.Reason_for_Topic_quality | e }}</div>
          </div>
        </div>
        <div class="block" style="margin-top:12px">
          <strong>Topic Evidence</strong>
          <div>{{ row.Topic_Evidence | e }}</div>
        </div>
        <div class="block summary-block">
          <strong>Summary</strong>
          <div>{{ row.Summary | e }}</div>
        </div>
      </article>
      {%- endfor %}
    </section>
    {%- endif %}
    {%- endfor %}
    
    {%- if data["Interview_Questionair_Responses"] %}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Interview Questions & Responses</h2>
    <section class="card" style="page-break-inside: avoid;">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Competency</th>
            <th>Predefined Question</th>
            <th>Question Asked</th>
            <th><span class="chip score ok" style="padding:0">Q Score</span></th>
            <th>Response</th>
            <th><span class="chip score ok" style="padding:0">R Score</span></th>
            <th>Summary</th>
          </tr>
        </thead>
        <tbody>
          {%- for row in data["Interview_Questionair_Responses"] %}
          {%- set q_score_class = 'ok' if row.Question_score >= 1 else 'warn' if row.Question_score > 0 else 'bad' %}
          {%- set r_score_class = 'ok' if row.Response_score >= 1 else 'warn' if row.Response_score > 0 else 'bad' %}
          <tr>
            <td>{{ row.id | e }}</td>
            <td>{{ row.Competency | e }}</td>
            <td>{{ row.Predefined_Question | e }}</td>
            <td>{{ row.Question_asked | e }}</td>
            <td class="{{ q_score_class }}">{{ row.Question_score | e }}</td>
            <td>{{ row.Response | e }}</td>
            <td class="{{ r_score_class }}">{{ row.Response_score | e }}</td>
            <td>{{ row.Summary | e }}</td>
          </tr>
          {%- endfor %}
        </tbody>
      </table>
    </section>
    
    <h3 style="margin-top:40px">Interview Metrics & Feedback</h3>
    <div class="grid-two" style="margin-top:14px">
      {%- if data["interview_coverage"] and data["interview_coverage"]["predefined_questions"] %}
      <div class="card block">
        <strong>Predefined Questions Coverage</strong>
        <ul>
          <li>Total: {{ data["interview_coverage"]["predefined_questions"]["Total_predefined_question"] }}</li>
          <li>Asked by Recruiter: {{ data["interview_coverage"]["predefined_questions"]["Questions_asked_by_recruiter_from_pre_defined"] }} ({{ data["interview_coverage"]["predefined_questions"]["Recruiter_Percentage"] }}%)</li>
          <li>Answered by Candidate: {{ data["interview_coverage"]["predefined_questions"]["Answer_given_by_candidate_against_recruiter_asked_questions"] }} ({{ data["interview_coverage"]["predefined_questions"]["Candidate_Percentage"] }}%)</li>
        </ul>
      </div>
      {%- endif %}

      {%- if data["interview_coverage"] and data["interview_coverage"]["extra_questions"] %}
      <div class="card block">
        <strong>Extra Questions Coverage</strong>
        <ul>
          <li>Total Extra: {{ data["interview_coverage"]["extra_questions"]["Total_extra_questions"] }}</li>
          <li>Helpful: {{ data["interview_coverage"]["extra_questions"]["Helpful_extra_questions"] }}</li>
          <li>Neutral: {{ data["interview_coverage"]["extra_questions"]["Neutral_extra_questions"] }}</li>
          <li>Unhelpful: {{ data["interview_coverage"]["extra_questions"]["Unhelpful_extra_questions"] }}</li>
          <li>Candidate Answered: {{ data["interview_coverage"]["extra_questions"]["Candidate_answered_extra_questions"] }}</li>
        </ul>
      </div>
      {%- endif %}
    </div>
    
    <div class="grid-two" style="margin-top:20px">
      {%- if data["interviewer_feedback"] %}
      <div class="card block">
        <strong>Interviewer Feedback</strong>
        <p><strong>Strengths:</strong> {{ data["interviewer_feedback"]["strengths"] | e }}</p>
        <p><strong>Weaknesses:</strong> {{ data["interviewer_feedback"]["weaknesses"] | e }}</p>
        <p><strong>Recommendations:</strong> {{ data["interviewer_feedback"]["recommendations"] | e }}</p>
        <p><strong>Average Score:</strong> {{ data["interviewer_feedback"]["average_score"] | e }}</p>
      </div>
      {%- endif %}

      {%- if data["candidate_feedback"] %}
      <div class="card block">
        <strong>Candidate Feedback</strong>
        <p><strong>Average Score:</strong> {{ data["candidate_feedback"]["average_score"] | e }}</p>
        <p><strong>Response Summary:</strong> {{ data["candidate_feedback"]["response_quality_summary"] | e }}</p>
        <p><strong>Recommendations:</strong> {{ data["candidate_feedback"]["recommendations"] | e }}</p>
        {%- if data["candidate_feedback"]["personality_assessment"] %}
        <h4>Personality Assessment</h4>
        {%- for key, traits in data["candidate_feedback"]["personality_assessment"].items() %}
        <p><strong>{{ key | replace('_', ' ') }}:</strong></p>
        <ul>
          {%- for trait, detail in traits.items() %}
          <li>{{ trait }}: {{ "✅" if detail.value else "❌" }} ({{ detail.reason }})</li>
          {%- endfor %}
        </ul>
        {%- endfor %}
        {%- endif %}
      </div>
      {%- endif %}
    </div>
    {%- endif %}
    
    {%- if data["Interactive Training Session Conducted by Recruiter"] %}
    <h2 style="margin-top:40px; margin-bottom: 20px;">Interactive Training Session</h2>
    <section class="card" style="page-break-inside: avoid;">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Topic</th>
            <th>Topic Content</th>
            <th>Recruiter Score</th>
            <th>Candidate Score</th>
            <th>Quality</th>
            <th>Evidence</th>
          </tr>
        </thead>
        <tbody>
          {%- for row in data["Interactive Training Session Conducted by Recruiter"] %}
          {%- set recruiter_score_class = 'ok' if row.Recruiter_Score >= 2 else 'warn' if row.Recruiter_Score > 0 else 'bad' %}
          {%- set candidate_score_class = 'ok' if row.Candidate_Score >= 1 else 'warn' if row.Candidate_Score > 0 else 'bad' %}
          <tr>
            <td>{{ row.id | e }}</td>
            <td>{{ row.Topic | e }}</td>
            <td>{{ row.Topic_Content | e }}</td>
            <td class="{{ recruiter_score_class }}">{{ row.Recruiter_Score | e }}</td>
            <td class="{{ candidate_score_class }}">{{ row.Candidate_Score | e }}</td>
            <td>{{ row.Topic_Quality | e }}</td>
            <td>{{ row.Topic_Evidence | e }}</td>
          </tr>
          {%- endfor %}
        </tbody>
      </table>
    </section>
    {%- endif %}

    {%- if data["Extra_Topics"] %}
    <h3 style="margin-top:40px; margin-bottom:10px;">Extra Topics</h3>
    <section class="topics">
      {%- for row in data["Extra_Topics"] %}
      <article class="card topic">
        <h3>{{ row.id | e }}) {{ row.Topic | e }}</h3>
        <div class="meta">
          {%- set score_class = 'ok' if row.Topic_Score >= 1 else 'warn' if row.Topic_Score > 0 else 'bad' %}
          {%- set score_emoji = '✅' if row.Topic_Score >= 1 else '⚠️' if row.Topic_Score > 0 else '❌' %}
          <span class="chip score {{ score_class }}">Score: {{ score_emoji }} {{ row.Topic_Score }}</span>
          {%- if row.Topic_Quality is defined %}<span class="chip">{{ row.Topic_Quality | e }}</span>{%- endif %}
        </div>
        <div class="block">
          <strong>Topic Content</strong>
          <div>{{ row.Topic_Content | e }}</div>
        </div>
        <div class="block summary-block">
          <strong>Summary</strong>
          <div>{{ row.Summary | e }}</div>
        </div>
      </article>
      {%- endfor %}
    </section>
    {%- endif %}

    {%- if data["Scoring_Summary"] %}
    <h3 style="margin-top:40px">Scoring Summary</h3>
    <section class="card" style="page-break-inside: avoid;">
      <table>
        <thead>
          <tr>
            <th>Metric</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          {%- for key, value in data["Scoring_Summary"].items() %}
          <tr>
            <td>{{ key | replace('_', ' ') }}</td>
            <td>{{ value }}</td>
          </tr>
          {%- endfor %}
        </tbody>
      </table>
    </section>
    {%- endif %}

    {%- if data["Candidate_Self_Understanding"] or data["Manager_Compliance_Assessment"] or data["Pre_Call_Planning"] or data["While_in_the_Shop"] %}
    <section class="card" style="margin-top:24px; page-break-inside: avoid;">
      <h3 style="margin-top:0">Compact Table View</h3>
      <table>
        <thead>
          <tr><th>ID</th><th>Topic</th><th>Score</th><th>Quality</th><th>Summary</th></tr>
        </thead>
        <tbody>
          {%- set rows = data.get("Candidate_Self_Understanding") or data.get("Manager_Compliance_Assessment") or data.get("Pre_Call_Planning") or data.get("While_in_the_Shop") %}
          {%- for row in rows %}
          {%- set score_class = 'ok' if row.Topic_Score >= 1 else 'warn' if row.Topic_Score > 0 else 'bad' %}
          <tr>
            <td>{{ row.id | e }}</td>
            <td>{{ row.Topic | e }}</td>
            <td class="{{ score_class }}">{{ row.Topic_Score | e }}</td>
            <td>{{ row.Topic_Quality | e }}</td>
            <td>{{ row.Summary | e }}</td>
          </tr>
          {%- endfor %}
        </tbody>
      </table>
      <p class="footer-note">Cards show detailed narratives. Table gives a quick overview.</p>
    </section>
    {%- endif %}
  </div>
</body>
</html>