<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{{ title | default("Candidate Self Understanding — Readout") }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg: #f7f9fc;
      --card: #ffffff;
      --muted: #6c757d;
      --text: #212529;
      --ok: #28a745;
      --warn: #f0ad4e;
      --bad: #dc3545;
      --chip-bg: #f1f3f9;
      --border: #e0e6ef;
      --radius: 12px;
      --gap: 20px;
      --max-width: 1100px;
      --shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font: 15px/1.6 system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      padding: 24px;
    }
    .container{max-width:var(--max-width);margin:0 auto}
    .title{
      font-size: 28px;
      font-weight: 800;
      margin: 6px 0 8px;
      color:var(--text);
    }
    .subtitle{color:var(--muted);margin:0 0 24px;font-weight:600}
    
    /* KPI summary */
    .kpis{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--gap);
      margin-bottom:32px;
    }
    @media (max-width: 900px){ .kpis{grid-template-columns: repeat(2, 1fr)} }
    @media (max-width: 480px){ .kpis{grid-template-columns: 1fr} }

    .card{
      background:var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding:18px;
      box-shadow: var(--shadow);
    }
    .kpi-label{color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.12em}
    .kpi-value{font-size:26px;font-weight:700;margin-top:8px;color:var(--text)}
    .kpi-sub{color:var(--muted);font-size:13px;margin-top:4px}

    /* Topics */
    .topics{display:grid;grid-template-columns: repeat(12, 1fr);gap:var(--gap)}
    .topic{grid-column: span 6; margin-bottom:20px; page-break-inside: avoid;}
    @media (max-width: 900px){ .topic{grid-column: span 12} }

    .topic h3{margin:0 0 8px;font-size:18px;color:var(--text)}
    .meta{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0 14px}
    .chip{
      padding:5px 10px;
      border-radius:999px;
      background:var(--chip-bg);
      border:1px solid var(--border);
      font-size:13px;
      color:var(--text);
    }
    .score.ok{color:var(--ok);border-color:rgba(40,167,69,.3)}
    .score.warn{color:var(--warn);border-color:rgba(240,173,78,.3)}
    .score.bad{color:var(--bad);border-color:rgba(220,53,69,.3)}

    .grid-two{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:720px){ .grid-two{grid-template-columns:1fr} }

    .block{
      background:#fafbfe;
      border:1px dashed var(--border);
      border-radius:8px;
      padding:12px;
      font-size:14px;
    }
    .block strong{display:block;margin-bottom:4px;color:var(--muted)}

    .block.summary-block{margin-top:12px}

    /* Table */
    table{width:100%;border-collapse:collapse;margin-top:20px;font-size:14px;border:1px solid var(--border)}
    th,td{padding:10px 12px;border:1px solid var(--border);vertical-align:top}
    th{background:#f1f3f9;font-weight:600;text-align:left;color:var(--text)}
    tbody tr:nth-child(even){background:#fafbfe}
    .footer-note{color:var(--muted);font-size:13px;margin-top:10px}

    /* PRINT OVERRIDES */
    @media print {
      body {
        background:#fff;
        color:#000;
        font-size:12pt;
        padding:0;
      }
      .card {
        border:1px solid #ccc;
        box-shadow:none;
        background:#fff;
      }
      .topics .topic, table {
        page-break-inside: avoid;
      }
      .chip {
        background:#f8f9fa;
        color:#000;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <p class="subtitle">{{ subtitle | default("Candidate_Self_Understanding") }}</p>
    <h1 class="title">{{ title | default("Candidate Self Understanding — Readout") }}</h1>

    <!-- KPI summary -->
    <section class="kpis">
      <div class="card"><div class="kpi-label">Subtotal Score</div><div class="kpi-value">{{ kpis.Subtotal_Score }}</div><div class="kpi-sub">Score achieved</div></div>
      <div class="card"><div class="kpi-label">Max Possible</div><div class="kpi-value">{{ kpis.Max_Possible_Score }}</div><div class="kpi-sub">Maximum score</div></div>
      <div class="card"><div class="kpi-label">Understanding %</div><div class="kpi-value">{{ kpis.Candidate_Understanding_Percentage }}</div><div class="kpi-sub">Overall understanding</div></div>
      <div class="card"><div class="kpi-label">Topics Covered</div><div class="kpi-value">{{ rows | length }}</div><div class="kpi-sub">Topics in report</div></div>
    </section>

    <!-- Topics grid -->
    <section class="topics">
      {%- for row in rows %}
      <article class="card topic">
        <h3>{{ row.id | e }}) {{ row.Topic | e }}</h3>
        <div class="meta">
          <span class="chip score {{ 'ok' if row.Topic_Score==2 else 'warn' if row.Topic_Score==1 else 'bad' }}">Score: {{ row.Topic_Score }}</span>
          <span class="chip">{{ row.Topic_Quality | e }}</span>
        </div>

        <div class="grid-two">
          <div class="block">
            <strong>Topic Content</strong>
            <div>{{ row.Topic_Content | e }}</div>
          </div>
          <div class="block">
            <strong>Reason for Quality</strong>
            <div>{{ row.Reason_for_Topic_quality | e }}</div>
          </div>
        </div>

        <div class="block" style="margin-top:12px">
          <strong>Candidate Evidence</strong>
          <div>{{ row.Topic_Evidence | e }}</div>
        </div>

        <div class="block summary-block">
          <strong>Summary</strong>
          <div>{{ row.Summary | e }}</div>
        </div>
      </article>
      {%- endfor %}
    </section>

    <!-- Compact table -->
    <section class="card" style="margin-top:24px; page-break-inside: avoid;">
      <h3 style="margin-top:0">Compact Table View</h3>
      <table>
        <thead>
          <tr><th>ID</th><th>Topic</th><th>Score</th><th>Quality</th><th>Summary</th></tr>
        </thead>
        <tbody>
          {%- for row in rows %}
          <tr>
            <td>{{ row.id | e }}</td>
            <td>{{ row.Topic | e }}</td>
            <td>{{ row.Topic_Score | e }}</td>
            <td>{{ row.Topic_Quality | e }}</td>
            <td>{{ row.Summary | e }}</td>
          </tr>
          {%- endfor %}
        </tbody>
      </table>
      <p class="footer-note">Cards show detailed narratives. Table gives a quick overview.</p>
    </section>
  </div>
</body>
</html>
